# Руководство пользователя системы контроля температуры

## Содержание
1. [Введение](#введение)
2. [Технические характеристики](#технические-характеристики)
3. [Установка и подключение](#установка-и-подключение)
4. [Первоначальная настройка](#первоначальная-настройка)
5. [Веб-интерфейс](#веб-интерфейс)
6. [Настройка сигнализации](#настройка-сигнализации)
7. [Работа с Modbus RTU](#работа-с-modbus-rtu)
8. [Индикация и управление](#индикация-и-управление)
9. [Обслуживание](#обслуживание)
10. [Устранение неисправностей](#устранение-неисправностей)

## Введение

Система контроля температуры предназначена для непрерывного мониторинга температуры в промышленных условиях. Устройство поддерживает до 60 точек измерения с различными типами датчиков и обеспечивает гибкую настройку аварийной сигнализации.

### Основные возможности
- Поддержка до 50 датчиков DS18B20 и 10 датчиков PT1000/PT100
- Веб-интерфейс для настройки и мониторинга
- Интерфейс Modbus RTU для интеграции в промышленные системы
- Гибкая настройка аварийной сигнализации с 4 уровнями приоритета
- OLED дисплей и светодиодная индикация
- Журналирование данных на SD карту
- Релейные выходы для подключения внешней сигнализации

## Технические характеристики

### Общие параметры
- Питание: 12-24В постоянного тока
- Потребление: не более 5 Вт
- Рабочая температура: -20°C до +70°C
- Степень защиты: IP20
- Габариты: 160×90×58 мм

### Измерительные каналы
- DS18B20: 50 каналов (адреса 0-49)
- PT1000/PT100: 10 каналов (адреса 50-59)
- Диапазон измерения: -40°C до +200°C
- Точность: ±0.5°C (DS18B20), ±0.3°C (PT1000)
- Разрешение: 0.1°C

### Интерфейсы
- Ethernet: 10/100 Мбит/с
- WiFi: 802.11 b/g/n
- RS-485: Modbus RTU (до 115200 бод)
- USB: для обновления прошивки

### Выходы
- Реле 1: Сирена (250В AC, 5А)
- Реле 2: Световой маяк (250В AC, 5А)
- Реле 3: Резерв (250В AC, 5А)

## Установка и подключение

### Подключение питания
1. Подключите источник питания 12-24В к клеммам PWR+ и PWR-
2. Соблюдайте полярность!
3. Рекомендуется использовать источник питания с запасом 20%

### Подключение датчиков DS18B20
1. Подключите датчики к шинам 1-4 (клеммы BUS1-BUS4)
2. Каждая шина поддерживает до 15 датчиков
3. Используйте кабель с витой парой для длинных линий
4. Максимальная длина линии: 100 метров

**Схема подключения DS18B20:**
```
BUS+ ----+---- Красный (VDD)
         |
         R 4.7кОм
         |
DATA ----+---- Желтый (DATA)
         
GND ----------- Черный (GND)
```

### Подключение датчиков PT1000
1. Подключите датчики к разъемам PT1-PT4
2. Используйте 3-проводную или 4-проводную схему
3. Для точных измерений используйте 4-проводную схему

**3-проводная схема:**
```
PT+ ---- Красный
PT- ---- Белый 1
PT- ---- Белый 2
```

### Подключение RS-485
```
A+ ---- Клемма A (зеленый)
B- ---- Клемма B (желтый)
GND --- Клемма GND (черный)
```

### Подключение реле
```
Реле 1 (Сирена):
COM --- Общий контакт
NO ---- Нормально открытый
NC ---- Нормально закрытый

Реле 2 (Маяк):
COM --- Общий контакт  
NO ---- Нормально открытый
NC ---- Нормально закрытый
```

## Первоначальная настройка

### Шаг 1: Включение устройства
1. Подайте питание на устройство
2. Дождитесь загрузки (около 30 секунд)
3. На дисплее появится сообщение о готовности

### Шаг 2: Подключение к сети
#### Вариант А: Ethernet
1. Подключите кабель Ethernet
2. Устройство автоматически получит IP-адрес по DHCP
3. IP-адрес отобразится на дисплее

#### Вариант Б: WiFi
1. При первом включении устройство создаст точку доступа
2. Имя сети: TempController-XXXX
3. Пароль: 12345678
4. Подключитесь к этой сети с компьютера или смартфона
5. Откройте браузер и перейдите по адресу 192.168.4.1
6. Введите параметры вашей WiFi сети

### Шаг 3: Доступ к веб-интерфейсу
1. Откройте веб-браузер
2. Введите IP-адрес устройства
3. Логин: admin
4. Пароль: admin (измените при первом входе!)

## Веб-интерфейс

### Главная страница (Панель управления)
Отображает текущее состояние всех точек измерения:
- Номер точки
- Название точки
- Текущая температура
- Минимальная/максимальная температура
- Статус (Норма/Тревога/Ошибка)

**Цветовая индикация:**
- Зеленый: нормальное состояние
- Желтый: предупреждение
- Красный: тревога
- Серый: датчик не подключен

### Страница "Точки измерения"
Позволяет:
- Назначить имена точкам измерения
- Привязать датчики к точкам
- Просмотреть информацию о датчиках

**Процедура привязки датчика:**
1. Нажмите кнопку "Привязать" напротив нужной точки
2. В выпадающем списке выберите доступный датчик
3. Введите название точки (до 20 символов)
4. Нажмите "Сохранить"

### Страница "Настройка тревог"
Таблица настройки параметров сигнализации:

| Параметр | Описание | Диапазон |
|----------|----------|----------|
| Название точки | Редактируемое название точки измерения | До 20 символов |
| Включить | Флажки включения/выключения тревог | Низкая/Высокая/Ошибка |
| Нижний порог | Температура для тревоги "Низкая температура" | -40...+200°C |
| Верхний порог | Температура для тревоги "Высокая температура" | -40...+200°C |
| Гистерезис | Зона нечувствительности | 0...10°C |
| Приоритет | Уровень важности тревоги | Низкий/Средний/Высокий/Критический |

**Включение/выключение тревог:**
- Установите флажок для активации соответствующего типа тревоги
- Снимите флажок для отключения тревоги
- Тревога ошибки датчика автоматически включается при привязке датчика

**Уровни приоритета:**
- **Критический**: Сирена + маяк постоянно
- **Высокий**: Сирена + маяк постоянно
- **Средний**: Сирена + маяк мигает (2с вкл / 30с выкл)
- **Низкий**: Сирена + индикация на дисплее

**Примечание:** Сирена (Реле 1) включается при ЛЮБОЙ активной тревоге любого приоритета и отключается только после подтверждения ВСЕХ активных тревог.

### Страница "Активные тревоги"
Отображает список текущих тревог:
- Время возникновения
- Точка измерения
- Тип тревоги
- Текущее значение
- Приоритет
- Статус (Активна/Подтверждена)

**Подтверждение тревог:**
1. Нажмите кнопку "Подтвердить" напротив тревоги
2. Или используйте кнопку на корпусе устройства
3. После подтверждения сирена отключится

## Настройка сигнализации

### Принцип работы
1. При выходе температуры за установленные пределы создается тревога
2. Тревога активирует световую и звуковую сигнализацию согласно приоритету
3. Оператор подтверждает тревогу нажатием кнопки
4. После подтверждения звуковая сигнализация отключается
5. При возврате температуры в норму тревога автоматически сбрасывается

### Гистерезис
Предотвращает частые срабатывания при колебаниях температуры:
```
Верхний порог: 30°C
Гистерезис: 2°C

Тревога включается при: T > 30°C
Тревога выключается при: T < 28°C
```

### Задержка повторной активации
После подтверждения тревога может быть повторно активирована через заданное время:
- Критический приоритет: 5 минут
- Высокий приоритет: 15 минут  
- Средний приоритет: 30 минут
- Низкий приоритет: 60 минут

## Работа с Modbus RTU

### Параметры подключения
- Скорость: 9600 бод (настраивается)
- Биты данных: 8
- Четность: Нет
- Стоповые биты: 1
- Адрес устройства: 1 (настраивается)

### Основные регистры

| Регистр | Описание | Тип |
|---------|----------|-----|
| 0 | ID устройства | R |
| 100-159 | Текущие температуры | R |
| 600-659 | Нижние пороги | R/W |
| 700-759 | Верхние пороги | R/W |
| 800-859 | Конфигурация тревог | R/W |
| 11-13 | Состояние реле 1-3 | R |
| 860-862 | Управление реле | R/W |
| 870-889 | Гистерезис | R/W |
| 899 | Команды | W |

### Конфигурация тревог (регистры 800-859)
Каждый регистр содержит:
- Бит 0: Включение тревоги низкой температуры
- Бит 1: Включение тревоги высокой температуры
- Бит 2: Включение тревоги ошибки датчика
- Биты 3-4: Приоритет тревоги низкой температуры
- Биты 5-6: Приоритет тревоги высокой температуры
- Биты 7-8: Приоритет тревоги ошибки датчика

Значения приоритетов:
- 0: Низкий
- 1: Средний
- 2: Высокий
- 3: Критический

### Пример чтения температуры (Python)
```python
import minimalmodbus

# Настройка соединения
device = minimalmodbus.Instrument('/dev/ttyUSB0', 1)
device.serial.baudrate = 9600

# Чтение температуры точки 0
temp_raw = device.read_register(100, 0, 3, signed=True)
temperature = temp_raw / 10.0
print(f"Температура: {temperature}°C")
```

### Настройка тревог через Modbus
```python
# Настройка тревог для точки 0
# Включить все тревоги: низкая=средний, высокая=критический, ошибка=высокий
config = 0x07  # Все тревоги включены (биты 0-2)
config |= (1 << 3)  # Низкая = средний приоритет
config |= (3 << 5)  # Высокая = критический приоритет  
config |= (2 << 7)  # Ошибка = высокий приоритет
device.write_register(800, config)

# Установка порогов
device.write_register(600, -100)  # Нижний порог: -10°C
device.write_register(700, 350)   # Верхний порог: 35°C
```

### Управление реле
```python
# Принудительное включение сирены (реле 1)
device.write_register(860, 2)  # 0=Авто, 1=Выкл, 2=Вкл

# Чтение состояния реле (регистр 11)
relay_status = device.read_register(11)
commanded = relay_status & 0x01  # бит 0: заданное состояние
actual = (relay_status & 0x02) >> 1  # бит 1: фактическое состояние
print(f"Реле 1 - Задано: {'Вкл' if commanded else 'Выкл'}, Факт: {'Вкл' if actual else 'Выкл'}")
```

### Применение настроек
После изменения конфигурации через Modbus необходимо записать команду применения:
```python
# Запись команды применения конфигурации
device.write_register(899, 1)
```

## Индикация и управление

### OLED дисплей
#### Режимы отображения:
1. **Нормальный режим**: Циклическое отображение точек с датчиками
2. **Режим тревоги**: Отображение активных тревог
3. **Системный режим**: Информация о системе

#### Формат отображения тревог:
При наличии активных тревог дисплей показывает их в 3-строчном формате:
- **Строка 1**: Приоритет (К/В/С/Н) и тип тревоги
- **Строка 2**: Название точки и температура
- **Строка 3**: Счетчик тревог (например, "1/3") и время активации (ЧЧ:ММ)

Пример отображения:
```
В: Высокая темп.
Точка1: 35.2°C
1/3  14:25
```

Для подтвержденных тревог на второй строке добавляется "ACK":
```
В: Высокая темп.
Точка1: 35.2°C ACK
2/5  14:26
```

#### Управление дисплеем:
- Дисплей автоматически выключается через 60 секунд
- Для включения нажмите кнопку
- Прокрутка длинных названий автоматическая (круговая, без рывков)
- Скорость прокрутки: 4 пикселя за обновление (настраивается)

### Светодиодная индикация

| LED | Цвет | Значение | Режим |
|-----|------|----------|-------|
| 1 | Красный | Критическая тревога | Постоянно горит |
| 2 | Желтый | Высокий приоритет | Постоянно горит |
| 3 | Синий | Средний приоритет | Постоянно горит |
| 3 | Синий | Низкий приоритет | Мигает |
| 4 | Зеленый | Система в норме | Постоянно горит |

**Примечание**: Приоритет тревоги отображается только через цвет светодиода, без текстовых обозначений на дисплее.

### Кнопка управления
- **Короткое нажатие (<1с)**:
  - Подтверждение тревоги (в режиме активных тревог)
  - Переключение между подтвержденными тревогами (в режиме подтвержденных тревог)
  - Переключение экранов (в системном режиме)
  - Пробуждение дисплея (если экран выключен)
  
- **Длинное нажатие (>3с)**:
  - Вход/выход из системного режима

### Автоматическое отключение экрана
- Экран автоматически выключается через 10 секунд бездействия в нормальном режиме
- Экран остается включенным при наличии любых тревог (активных или подтвержденных)
- Подтвержденные тревоги автоматически сменяются каждые 5 секунд
- Нажатие кнопки мгновенно включает экран без выполнения других действий

### Системный режим
Для просмотра системной информации:
1. Удерживайте кнопку 3 секунды
2. Короткими нажатиями переключайте экраны:
   - IP-адрес и состояние сети
   - Количество настроенных точек
   - Статистика тревог
   - Состояние Modbus
3. Для выхода снова удерживайте кнопку 3 секунды

## Обслуживание

### Регулярное обслуживание
#### Ежемесячно:
1. Проверьте журналы на наличие ошибок
2. Очистите вентиляционные отверстия
3. Проверьте надежность соединений

#### Ежеквартально:
1. Загрузите и архивируйте журналы
2. Проверьте калибровку датчиков
3. Протестируйте работу сигнализации

#### Ежегодно:
1. Замените батарею часов реального времени
2. Проверьте состояние реле
3. Обновите прошивку при наличии новой версии

### Резервное копирование
1. Перейдите в раздел "Система" → "Резервное копирование"
2. Нажмите "Создать резервную копию"
3. Сохраните файл конфигурации на компьютер
4. Рекомендуется делать резервные копии после каждого изменения настроек

### Обновление прошивки
1. Загрузите файл прошивки с сайта производителя
2. Перейдите в раздел "Система" → "Обновление"
3. Выберите файл прошивки
4. Нажмите "Обновить"
5. НЕ ОТКЛЮЧАЙТЕ питание во время обновления!

### Сброс к заводским настройкам
1. Перейдите в "Система" → "Сброс настроек"
2. Введите код подтверждения: 1234
3. Нажмите "Сбросить"
4. Устройство перезагрузится с заводскими настройками

## Устранение неисправностей

### Устройство не включается
1. Проверьте напряжение питания (12-24В)
2. Проверьте полярность подключения
3. Проверьте предохранитель

### Нет связи по сети
1. Проверьте сетевой кабель
2. Проверьте настройки IP-адреса
3. Попробуйте перезагрузить устройство
4. Проверьте настройки файрвола

### Датчик не определяется
1. Проверьте правильность подключения
2. Проверьте сопротивление подтягивающего резистора (4.7кОм)
3. Попробуйте подключить датчик к другой шине
4. Проверьте длину кабеля (не более 100м)

### Неправильные показания температуры
1. Проверьте тип датчика в настройках
2. Для PT1000 проверьте схему подключения
3. Проверьте наличие помех на линии
4. Выполните калибровку датчика

### Тревога не срабатывает
1. Проверьте настройки порогов
2. Убедитесь, что приоритет не "Отключен"
3. Проверьте привязку датчика к точке
4. Проверьте работу реле тестовой командой

### Частые ложные срабатывания
1. Увеличьте значение гистерезиса
2. Проверьте стабильность показаний датчика
3. Увеличьте время усреднения
4. Проверьте экранирование кабелей

### Ошибка связи Modbus
1. Проверьте параметры связи (скорость, адрес)
2. Проверьте подключение A+ и B-
3. Проверьте терминальные резисторы (120 Ом)
4. Используйте экранированный кабель

## Коды ошибок

| Код | Описание | Решение |
|-----|----------|---------|
| E01 | Ошибка датчика | Проверьте подключение |
| E02 | Ошибка SD карты | Проверьте карту памяти |
| E03 | Ошибка сети | Проверьте настройки сети |
| E04 | Ошибка конфигурации | Сбросьте настройки |
| E05 | Перегрев устройства | Улучшите вентиляцию |

## Техническая поддержка

При обращении в службу поддержки подготовьте:
- Серийный номер устройства
- Версию прошивки
- Описание проблемы
- Журналы событий
- Схему подключения

**Контакты:**
- Email: support@tempcontroller.ru
- Телефон: 8-800-XXX-XX-XX
- Сайт: www.tempcontroller.ru

## Гарантийные обязательства

Гарантийный срок: 24 месяца с даты продажи

Гарантия не распространяется на:
- Механические повреждения
- Повреждения от неправильного подключения
- Повреждения от перенапряжения
- Модификации устройства

Для гарантийного обслуживания сохраняйте:
- Гарантийный талон
- Чек о покупке
- Заводскую упаковку

## Приложения

### А. Схема подключения
[Здесь должна быть принципиальная схема подключения всех компонентов]

### Б. Размеры корпуса
[Здесь должен быть чертеж с размерами]

### В. Спецификация клеммников
[Здесь должна быть таблица с описанием всех клемм]

### Г. Список совместимых датчиков
- DS18B20 (любой производитель)
- PT1000 (класс A или B)
- PT100 (класс A или B)

---
*Версия документа: 2.0*  
*Дата: Декабрь 2024*
